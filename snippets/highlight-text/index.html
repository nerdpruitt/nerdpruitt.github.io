<pre><code class="language-js">/**
 * Highlight text in a given root node
 *
 * @see
 *      https://developer.mozilla.org/en-US/docs/Web/API/Document/createTreeWalker
 *      https://stackoverflow.com/questions/10730309/find-all-text-nodes-in-html-page
 *      https://gist.github.com/Sphinxxxx/ed372d176c5c2c1fd9ea1d8d6801989b
 *      https://paul.kinlan.me/dom-treewalker/
 *
 */

const Highlighter = () =&gt; {
    const walkNodeTree = (root, options) =&gt; {
        options = options || {};

        const inspect = options.inspect || (n =&gt; true),
              collect = options.collect || (n =&gt; true);

        const walker = document.createTreeWalker(
            root,
            NodeFilter.SHOW_ALL,
            {
                acceptNode: function(node) {
                    if(!inspect(node)) { return NodeFilter.FILTER_REJECT; }
                    if(!collect(node)) { return NodeFilter.FILTER_SKIP; }

                    return NodeFilter.FILTER_ACCEPT;
                }
            }
        );

        const nodes = [];
        let n;

        while(n = walker.nextNode()) {
            options.callback &amp;&amp; options.callback(n);
            nodes.push(n);
        }

        return nodes;
    }

    const highlight = (element, pattern) =&gt; {
        // Find all text nodes while skipping style and script tags,
        // and anything that isn't a textNode (nodeType === 3)
        const textNodes = walkNodeTree(element, {
            inspect: n =&gt; !['STYLE', 'SCRIPT'].includes(n.nodeName),
            collect: n =&gt; (n.nodeType === 3)
        });

        var node;
        for (var i = 0; node = textNodes[i]; i++) {
            // Test if it matches our highlighting pattern
            var matcher = node.textContent.match(new RegExp(pattern, &quot;gi&quot;));

            // If it matches and has a parentNode
            if (matcher &amp;&amp; node.parentNode) {
                node.parentNode.innerHTML = node.parentNode.innerHTML.replace(new RegExp(pattern, &quot;gi&quot;), match =&gt; {
                    return '&lt;mark class=&quot;is-highlighted&quot;&gt;' + match + '&lt;/mark&gt;';
                });
            }
        }
    }

    return {
        highlight
    };
};

export { Highlighter };
</code></pre>
